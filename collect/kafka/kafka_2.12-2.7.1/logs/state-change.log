[2021-10-19 19:16:19,991] INFO [Controller id=1 epoch=5] Sending UpdateMetadata request to brokers Set(1) for 0 partitions (state.change.logger)
[2021-10-19 19:16:20,061] INFO [Controller id=1 epoch=5] Sending LeaderAndIsr request to broker 1 with 0 become-leader and 1 become-follower partitions (state.change.logger)
[2021-10-19 19:16:20,061] INFO [Controller id=1 epoch=5] Sending UpdateMetadata request to brokers Set(1) for 1 partitions (state.change.logger)
[2021-10-19 19:16:20,109] INFO [Controller id=1 epoch=5] Partition test_topic-0 state changed to (Leader:-1,ISR:1,3,LeaderEpoch:1,ControllerEpoch:5) after removing replica 2 from the ISR as part of transition to OfflineReplica (state.change.logger)
[2021-10-19 19:16:20,109] INFO [Controller id=1 epoch=5] Partition sample-0 state changed to (Leader:-1,ISR:2,LeaderEpoch:1,ControllerEpoch:5) after removing replica 2 from the ISR as part of transition to OfflineReplica (state.change.logger)
[2021-10-19 19:16:20,135] INFO [Controller id=1 epoch=5] Partition test_topic-0 state changed to (Leader:-1,ISR:1,LeaderEpoch:2,ControllerEpoch:5) after removing replica 3 from the ISR as part of transition to OfflineReplica (state.change.logger)
[2021-10-19 19:16:20,136] INFO [Controller id=1 epoch=5] Partition test-0 state changed to (Leader:-1,ISR:3,LeaderEpoch:1,ControllerEpoch:5) after removing replica 3 from the ISR as part of transition to OfflineReplica (state.change.logger)
[2021-10-19 19:16:20,136] INFO [Controller id=1 epoch=5] Sending LeaderAndIsr request to broker 1 with 0 become-leader and 1 become-follower partitions (state.change.logger)
[2021-10-19 19:16:20,136] INFO [Controller id=1 epoch=5] Sending UpdateMetadata request to brokers Set(1) for 3 partitions (state.change.logger)
[2021-10-19 19:16:20,183] ERROR [Controller id=1 epoch=5] Controller 1 epoch 5 failed to change state for partition test-0 from OfflinePartition to OnlinePartition (state.change.logger)
kafka.common.StateChangeFailedException: Failed to elect leader for partition test-0 under strategy OfflinePartitionLeaderElectionStrategy(false)
	at kafka.controller.ZkPartitionStateMachine.$anonfun$doElectLeaderForPartitions$7(PartitionStateMachine.scala:431)
	at scala.collection.mutable.ResizableArray.foreach(ResizableArray.scala:62)
	at scala.collection.mutable.ResizableArray.foreach$(ResizableArray.scala:55)
	at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:49)
	at kafka.controller.ZkPartitionStateMachine.doElectLeaderForPartitions(PartitionStateMachine.scala:428)
	at kafka.controller.ZkPartitionStateMachine.electLeaderForPartitions(PartitionStateMachine.scala:339)
	at kafka.controller.ZkPartitionStateMachine.doHandleStateChanges(PartitionStateMachine.scala:238)
	at kafka.controller.ZkPartitionStateMachine.handleStateChanges(PartitionStateMachine.scala:158)
	at kafka.controller.PartitionStateMachine.triggerOnlineStateChangeForPartitions(PartitionStateMachine.scala:74)
	at kafka.controller.PartitionStateMachine.triggerOnlinePartitionStateChange(PartitionStateMachine.scala:59)
	at kafka.controller.PartitionStateMachine.startup(PartitionStateMachine.scala:42)
	at kafka.controller.KafkaController.onControllerFailover(KafkaController.scala:261)
	at kafka.controller.KafkaController.elect(KafkaController.scala:1514)
	at kafka.controller.KafkaController.processStartup(KafkaController.scala:1417)
	at kafka.controller.KafkaController.process(KafkaController.scala:2434)
	at kafka.controller.QueuedEvent.process(ControllerEventManager.scala:52)
	at kafka.controller.ControllerEventManager$ControllerEventThread.process$1(ControllerEventManager.scala:130)
	at kafka.controller.ControllerEventManager$ControllerEventThread.$anonfun$doWork$1(ControllerEventManager.scala:133)
	at scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.java:23)
	at kafka.metrics.KafkaTimer.time(KafkaTimer.scala:31)
	at kafka.controller.ControllerEventManager$ControllerEventThread.doWork(ControllerEventManager.scala:133)
	at kafka.utils.ShutdownableThread.run(ShutdownableThread.scala:96)
[2021-10-19 19:16:20,184] ERROR [Controller id=1 epoch=5] Controller 1 epoch 5 failed to change state for partition sample-0 from OfflinePartition to OnlinePartition (state.change.logger)
kafka.common.StateChangeFailedException: Failed to elect leader for partition sample-0 under strategy OfflinePartitionLeaderElectionStrategy(false)
	at kafka.controller.ZkPartitionStateMachine.$anonfun$doElectLeaderForPartitions$7(PartitionStateMachine.scala:431)
	at scala.collection.mutable.ResizableArray.foreach(ResizableArray.scala:62)
	at scala.collection.mutable.ResizableArray.foreach$(ResizableArray.scala:55)
	at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:49)
	at kafka.controller.ZkPartitionStateMachine.doElectLeaderForPartitions(PartitionStateMachine.scala:428)
	at kafka.controller.ZkPartitionStateMachine.electLeaderForPartitions(PartitionStateMachine.scala:339)
	at kafka.controller.ZkPartitionStateMachine.doHandleStateChanges(PartitionStateMachine.scala:238)
	at kafka.controller.ZkPartitionStateMachine.handleStateChanges(PartitionStateMachine.scala:158)
	at kafka.controller.PartitionStateMachine.triggerOnlineStateChangeForPartitions(PartitionStateMachine.scala:74)
	at kafka.controller.PartitionStateMachine.triggerOnlinePartitionStateChange(PartitionStateMachine.scala:59)
	at kafka.controller.PartitionStateMachine.startup(PartitionStateMachine.scala:42)
	at kafka.controller.KafkaController.onControllerFailover(KafkaController.scala:261)
	at kafka.controller.KafkaController.elect(KafkaController.scala:1514)
	at kafka.controller.KafkaController.processStartup(KafkaController.scala:1417)
	at kafka.controller.KafkaController.process(KafkaController.scala:2434)
	at kafka.controller.QueuedEvent.process(ControllerEventManager.scala:52)
	at kafka.controller.ControllerEventManager$ControllerEventThread.process$1(ControllerEventManager.scala:130)
	at kafka.controller.ControllerEventManager$ControllerEventThread.$anonfun$doWork$1(ControllerEventManager.scala:133)
	at scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.java:23)
	at kafka.metrics.KafkaTimer.time(KafkaTimer.scala:31)
	at kafka.controller.ControllerEventManager$ControllerEventThread.doWork(ControllerEventManager.scala:133)
	at kafka.utils.ShutdownableThread.run(ShutdownableThread.scala:96)
[2021-10-19 19:16:20,185] INFO [Controller id=1 epoch=5] Changed partition test_topic-0 from OfflinePartition to OnlinePartition with state LeaderAndIsr(leader=1, leaderEpoch=3, isr=List(1), zkVersion=3) (state.change.logger)
[2021-10-19 19:16:20,185] INFO [Controller id=1 epoch=5] Sending LeaderAndIsr request to broker 1 with 1 become-leader and 0 become-follower partitions (state.change.logger)
[2021-10-19 19:16:20,185] INFO [Controller id=1 epoch=5] Sending UpdateMetadata request to brokers Set(1) for 1 partitions (state.change.logger)
[2021-10-19 19:16:20,195] INFO [Broker id=1] Handling LeaderAndIsr request correlationId 1 from controller 1 for 1 partitions (state.change.logger)
[2021-10-19 19:16:20,206] ERROR [Broker id=1] Received LeaderAndIsrRequest with correlation id 1 from controller 1 epoch 5 for partition test_topic-0 (last update controller epoch 4) but cannot become follower since the new leader 2 is unavailable. (state.change.logger)
[2021-10-19 19:16:20,226] INFO [Broker id=1] Stopped fetchers as part of become-follower request from controller 1 epoch 5 with correlation id 1 for 0 partitions (state.change.logger)
[2021-10-19 19:16:20,229] INFO [Broker id=1] Finished LeaderAndIsr request in 35ms correlationId 1 from controller 1 for 1 partitions (state.change.logger)
[2021-10-19 19:16:20,237] INFO [Broker id=1] Add 1 partitions and deleted 0 partitions from metadata cache in response to UpdateMetadata request sent by controller 1 epoch 5 with correlation id 2 (state.change.logger)
[2021-10-19 19:16:20,245] INFO [Broker id=1] Handling LeaderAndIsr request correlationId 3 from controller 1 for 1 partitions (state.change.logger)
[2021-10-19 19:16:20,245] ERROR [Broker id=1] Received LeaderAndIsrRequest with correlation id 3 from controller 1 epoch 5 for partition test_topic-0 (last update controller epoch 5) but cannot become follower since the new leader -1 is unavailable. (state.change.logger)
[2021-10-19 19:16:20,245] INFO [Broker id=1] Stopped fetchers as part of become-follower request from controller 1 epoch 5 with correlation id 3 for 0 partitions (state.change.logger)
[2021-10-19 19:16:20,246] INFO [Broker id=1] Finished LeaderAndIsr request in 7ms correlationId 3 from controller 1 for 1 partitions (state.change.logger)
[2021-10-19 19:16:20,272] INFO [Broker id=1] Add 3 partitions and deleted 0 partitions from metadata cache in response to UpdateMetadata request sent by controller 1 epoch 5 with correlation id 4 (state.change.logger)
[2021-10-19 19:16:20,277] INFO [Broker id=1] Handling LeaderAndIsr request correlationId 5 from controller 1 for 1 partitions (state.change.logger)
[2021-10-19 19:16:20,279] INFO [Broker id=1] Stopped fetchers as part of LeaderAndIsr request correlationId 5 from controller 1 epoch 5 as part of the become-leader transition for 1 partitions (state.change.logger)
[2021-10-19 19:16:20,282] INFO [Broker id=1] Leader test_topic-0 starts at leader epoch 3 from offset 13 with high watermark 13 ISR [1] addingReplicas [] removingReplicas []. Previous leader epoch was -1. (state.change.logger)
[2021-10-19 19:16:20,308] INFO [Broker id=1] Finished LeaderAndIsr request in 31ms correlationId 5 from controller 1 for 1 partitions (state.change.logger)
[2021-10-19 19:16:20,309] INFO [Broker id=1] Add 1 partitions and deleted 0 partitions from metadata cache in response to UpdateMetadata request sent by controller 1 epoch 5 with correlation id 6 (state.change.logger)
[2021-10-19 19:16:41,531] INFO [Controller id=1 epoch=5] Sending UpdateMetadata request to brokers Set(1) for 0 partitions (state.change.logger)
[2021-10-19 19:16:41,531] INFO [Controller id=1 epoch=5] Sending UpdateMetadata request to brokers Set(2) for 3 partitions (state.change.logger)
[2021-10-19 19:16:41,534] INFO [Controller id=1 epoch=5] Sending LeaderAndIsr request to broker 2 with 0 become-leader and 2 become-follower partitions (state.change.logger)
[2021-10-19 19:16:41,534] INFO [Controller id=1 epoch=5] Sending UpdateMetadata request to brokers Set(1, 2) for 2 partitions (state.change.logger)
[2021-10-19 19:16:41,538] INFO [Broker id=1] Add 2 partitions and deleted 0 partitions from metadata cache in response to UpdateMetadata request sent by controller 1 epoch 5 with correlation id 8 (state.change.logger)
[2021-10-19 19:16:41,575] ERROR [Controller id=1 epoch=5] Controller 1 epoch 5 failed to change state for partition test-0 from OfflinePartition to OnlinePartition (state.change.logger)
kafka.common.StateChangeFailedException: Failed to elect leader for partition test-0 under strategy OfflinePartitionLeaderElectionStrategy(false)
	at kafka.controller.ZkPartitionStateMachine.$anonfun$doElectLeaderForPartitions$7(PartitionStateMachine.scala:431)
	at scala.collection.mutable.ResizableArray.foreach(ResizableArray.scala:62)
	at scala.collection.mutable.ResizableArray.foreach$(ResizableArray.scala:55)
	at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:49)
	at kafka.controller.ZkPartitionStateMachine.doElectLeaderForPartitions(PartitionStateMachine.scala:428)
	at kafka.controller.ZkPartitionStateMachine.electLeaderForPartitions(PartitionStateMachine.scala:339)
	at kafka.controller.ZkPartitionStateMachine.doHandleStateChanges(PartitionStateMachine.scala:238)
	at kafka.controller.ZkPartitionStateMachine.handleStateChanges(PartitionStateMachine.scala:158)
	at kafka.controller.PartitionStateMachine.triggerOnlineStateChangeForPartitions(PartitionStateMachine.scala:74)
	at kafka.controller.PartitionStateMachine.triggerOnlinePartitionStateChange(PartitionStateMachine.scala:59)
	at kafka.controller.KafkaController.onBrokerStartup(KafkaController.scala:535)
	at kafka.controller.KafkaController.processBrokerChange(KafkaController.scala:1588)
	at kafka.controller.KafkaController.process(KafkaController.scala:2400)
	at kafka.controller.QueuedEvent.process(ControllerEventManager.scala:52)
	at kafka.controller.ControllerEventManager$ControllerEventThread.process$1(ControllerEventManager.scala:130)
	at kafka.controller.ControllerEventManager$ControllerEventThread.$anonfun$doWork$1(ControllerEventManager.scala:133)
	at scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.java:23)
	at kafka.metrics.KafkaTimer.time(KafkaTimer.scala:31)
	at kafka.controller.ControllerEventManager$ControllerEventThread.doWork(ControllerEventManager.scala:133)
	at kafka.utils.ShutdownableThread.run(ShutdownableThread.scala:96)
[2021-10-19 19:16:41,575] INFO [Controller id=1 epoch=5] Changed partition sample-0 from OfflinePartition to OnlinePartition with state LeaderAndIsr(leader=2, leaderEpoch=2, isr=List(2), zkVersion=2) (state.change.logger)
[2021-10-19 19:16:41,575] INFO [Controller id=1 epoch=5] Sending LeaderAndIsr request to broker 2 with 1 become-leader and 0 become-follower partitions (state.change.logger)
[2021-10-19 19:16:41,575] INFO [Controller id=1 epoch=5] Sending UpdateMetadata request to brokers Set(1, 2) for 1 partitions (state.change.logger)
[2021-10-19 19:16:41,583] INFO [Broker id=1] Add 1 partitions and deleted 0 partitions from metadata cache in response to UpdateMetadata request sent by controller 1 epoch 5 with correlation id 9 (state.change.logger)
[2021-10-19 19:16:42,145] INFO [Controller id=1 epoch=5] Sending UpdateMetadata request to brokers Set(1, 2) for 1 partitions (state.change.logger)
[2021-10-19 19:16:42,150] INFO [Broker id=1] Add 1 partitions and deleted 0 partitions from metadata cache in response to UpdateMetadata request sent by controller 1 epoch 5 with correlation id 10 (state.change.logger)
[2021-10-19 19:16:59,533] INFO [Controller id=1 epoch=5] Sending UpdateMetadata request to brokers Set(1, 2) for 0 partitions (state.change.logger)
[2021-10-19 19:16:59,534] INFO [Controller id=1 epoch=5] Sending UpdateMetadata request to brokers Set(3) for 3 partitions (state.change.logger)
[2021-10-19 19:16:59,534] INFO [Controller id=1 epoch=5] Sending LeaderAndIsr request to broker 3 with 0 become-leader and 2 become-follower partitions (state.change.logger)
[2021-10-19 19:16:59,534] INFO [Controller id=1 epoch=5] Sending UpdateMetadata request to brokers Set(1, 2, 3) for 2 partitions (state.change.logger)
[2021-10-19 19:16:59,540] INFO [Broker id=1] Add 2 partitions and deleted 0 partitions from metadata cache in response to UpdateMetadata request sent by controller 1 epoch 5 with correlation id 12 (state.change.logger)
[2021-10-19 19:16:59,563] INFO [Controller id=1 epoch=5] Changed partition test-0 from OfflinePartition to OnlinePartition with state LeaderAndIsr(leader=3, leaderEpoch=2, isr=List(3), zkVersion=2) (state.change.logger)
[2021-10-19 19:16:59,563] INFO [Controller id=1 epoch=5] Sending LeaderAndIsr request to broker 3 with 1 become-leader and 0 become-follower partitions (state.change.logger)
[2021-10-19 19:16:59,563] INFO [Controller id=1 epoch=5] Sending UpdateMetadata request to brokers Set(1, 2, 3) for 1 partitions (state.change.logger)
[2021-10-19 19:16:59,564] INFO [Broker id=1] Add 1 partitions and deleted 0 partitions from metadata cache in response to UpdateMetadata request sent by controller 1 epoch 5 with correlation id 13 (state.change.logger)
[2021-10-19 19:17:00,133] INFO [Controller id=1 epoch=5] Sending UpdateMetadata request to brokers Set(1, 2, 3) for 1 partitions (state.change.logger)
[2021-10-19 19:17:00,135] INFO [Broker id=1] Add 1 partitions and deleted 0 partitions from metadata cache in response to UpdateMetadata request sent by controller 1 epoch 5 with correlation id 14 (state.change.logger)
[2021-10-19 19:21:25,275] INFO [Controller id=1 epoch=5] Changed partition test_topic-0 from OnlinePartition to OnlinePartition with state LeaderAndIsr(leader=2, leaderEpoch=4, isr=List(1, 2, 3), zkVersion=6) (state.change.logger)
[2021-10-19 19:21:25,275] INFO [Controller id=1 epoch=5] Sending LeaderAndIsr request to broker 2 with 1 become-leader and 0 become-follower partitions (state.change.logger)
[2021-10-19 19:21:25,275] INFO [Controller id=1 epoch=5] Sending LeaderAndIsr request to broker 1 with 0 become-leader and 1 become-follower partitions (state.change.logger)
[2021-10-19 19:21:25,275] INFO [Controller id=1 epoch=5] Sending LeaderAndIsr request to broker 3 with 0 become-leader and 1 become-follower partitions (state.change.logger)
[2021-10-19 19:21:25,275] INFO [Controller id=1 epoch=5] Sending UpdateMetadata request to brokers Set(1, 2, 3) for 1 partitions (state.change.logger)
[2021-10-19 19:21:25,278] INFO [Broker id=1] Handling LeaderAndIsr request correlationId 15 from controller 1 for 1 partitions (state.change.logger)
[2021-10-19 19:21:25,279] INFO [Broker id=1] Follower test_topic-0 starts at leader epoch 4 from offset 13 with high watermark 13. Previous leader epoch was 3. (state.change.logger)
[2021-10-19 19:21:25,279] INFO [Broker id=1] Stopped fetchers as part of become-follower request from controller 1 epoch 5 with correlation id 15 for 1 partitions (state.change.logger)
[2021-10-19 19:21:25,299] INFO [Broker id=1] Finished LeaderAndIsr request in 22ms correlationId 15 from controller 1 for 1 partitions (state.change.logger)
[2021-10-19 19:21:25,303] INFO [Broker id=1] Add 1 partitions and deleted 0 partitions from metadata cache in response to UpdateMetadata request sent by controller 1 epoch 5 with correlation id 16 (state.change.logger)
